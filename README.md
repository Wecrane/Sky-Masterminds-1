# Sky-Masterminds 智能巡线小车

基于 **STM32F103C8** 微控制器的智能巡线小车项目，支持自动巡线和蓝牙遥控两种工作模式。

## ✨ 功能特点

- 🛤️ **自动巡线模式** - 使用5路红外传感器实现精准巡线
- 📱 **蓝牙遥控模式** - 通过蓝牙串口实现远程控制
- ⚙️ **PID控制算法** - 实现平滑的速度和转向控制
- 📊 **OLED显示** - 实时显示工作状态和参数
- 🎛️ **按键切换** - 一键切换工作模式
- 📡 **MPU6050姿态检测** - 获取偏航角数据辅助控制

## 🔧 硬件配置

| 模块       | 型号/规格     | 说明               |
| ---------- | ------------- | ------------------ |
| 主控芯片   | STM32F103C8T6 | ARM Cortex-M3 内核 |
| 电机驱动   | TB6612/L298N  | 双路直流电机驱动   |
| 巡线传感器 | 5路红外传感器 | L2, L1, M, R1, R2  |
| 姿态传感器 | MPU6050       | 6轴加速度计+陀螺仪 |
| 显示屏     | 0.96寸 OLED   | I2C/SPI 接口       |
| 蓝牙模块   | HC-05/HC-06   | 串口蓝牙通信       |
| 编码器     | 增量式编码器  | 测速反馈           |

## 📁 项目结构

```
Sky-Masterminds-1/
├── User/              # 用户主程序
│   └── main.c         # 主函数入口
├── Control/           # 控制算法
│   ├── pid.c/h        # PID控制器
│   ├── element.c/h    # 元素处理（巡线逻辑）
│   ├── menu.c/h       # 菜单显示
│   └── error.c/h      # 误差处理
├── Hardware/          # 硬件驱动
│   ├── Motor.c/h      # 电机驱动
│   ├── Encoder.c/h    # 编码器驱动
│   ├── MPU6050.c/h    # 陀螺仪驱动
│   ├── OLED.c/h       # OLED显示驱动
│   ├── sensor.c/h     # 巡线传感器
│   ├── Serial.c/h     # 串口通信
│   ├── PWM.c/h        # PWM输出
│   ├── Key.c/h        # 按键检测
│   └── kalman.c/h     # 卡尔曼滤波
├── Library/           # STM32标准外设库
├── Start/             # 启动文件
├── System/            # 系统配置
└── Project.uvprojx    # Keil MDK 工程文件
```

## 🚀 快速开始

### 开发环境

- **IDE**: Keil MDK-ARM V5
- **编译器**: ARM Compiler V5/V6
- **调试器**: ST-Link V2 / J-Link

### 编译与烧录

1. 使用 Keil MDK 打开 `Project.uvprojx` 工程文件
2. 点击 `Build` (F7) 编译项目
3. 连接 ST-Link 调试器
4. 点击 `Download` (F8) 烧录程序

### 工作模式

| 模式     | 触发方式 | 功能描述              |
| -------- | -------- | --------------------- |
| 待机模式 | 默认     | OLED显示模式选择菜单  |
| 巡线模式 | 按键1    | 自动循迹，PID控制转向 |
| 蓝牙模式 | 按键2    | 等待蓝牙指令控制      |

## 📡 蓝牙控制命令

通过蓝牙串口发送以下命令控制小车：

| 命令     | 简写 | 功能                         |
| -------- | ---- | ---------------------------- |
| `FWD`    | `W`  | 前进                         |
| `BWD`    | `S`  | 后退                         |
| `TL`     | `A`  | 左转                         |
| `TR`     | `D`  | 右转                         |
| `STOP`   | `X`  | 停止                         |
| `SPD:xx` | -    | 设置基础速度 (如 `SPD:50`)   |
| `FWD:xx` | -    | 以指定速度前进 (如 `FWD:60`) |
| `BWD:xx` | -    | 以指定速度后退               |
| `?`      | -    | 查询当前状态                 |
| `HELP`   | -    | 显示帮助信息                 |

## ⚙️ PID参数调节

在 `Control/pid.c` 中可以调节PID参数：

```c
// 速度环 PID
int TURN_PID_L[3] = {Kp, Ki, Kd};  // 左轮
int TURN_PID_R[3] = {Kp, Ki, Kd};  // 右轮

// 位置环 PD
float PLACE_PID[3] = {Kp, 0, Kd};  // 巡线转向
```

## 📌 引脚定义

### 巡线传感器

- L2, L1, M, R1, R2 → GPIO输入

### 电机控制

- PWM_L, PWM_R → TIM1 PWM输出
- DIR_L, DIR_R → GPIO方向控制

### 通信接口

- USART1 → 蓝牙模块 (TX: PA9, RX: PA10)
- I2C → MPU6050, OLED

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📄 许可证

本项目采用 MIT 许可证 - 详情请参阅 [LICENSE](LICENSE) 文件

## 📞 联系方式

如有问题或建议，请通过 GitHub Issues 联系我们。

---

⭐ 如果这个项目对你有帮助，请给我们一个 Star！
